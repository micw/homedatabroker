package de.wyraz.tibberpulse.sml;

import static org.assertj.core.api.Assertions.assertThat;

import org.apache.commons.codec.binary.Hex;
import org.junit.Ignore;
import org.junit.Test;

/**
 * Tests taken from https://github.com/devZer0/libsml-testing
 * @author mwyraz
 *
 */
public class LibSMLTests {

	static {
		SMLDecoder.DUMP_RAW_SML=true;
	}
	
	@Test
	public void testDZG_DVS_7412_2_jmberg() throws Exception {
		// DZG_DVS-7412.2_jmberg.hex
		// Remarks: Wrongly encoded power value 356.24 as -299.12
		// FIXME: check what workaround is needed here
		
		String payload="1B1B1B1B010101017605F12CAD07620062007263010176010102310B0A01445A47000282225E7262016505E748D7620263955C007605F22CAD07620062007263070177010B0A01445A47000282225E070100620AFFFF7262016505E748D77577070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A47000282225E0177070100010800FF641C01047262016200621E52FF65033C93890177070100020800FF017262016200621E52FF650FA49A9E0177070100100700FF017262016200621B52FE538B28010101636B99007605F32CAD076200620072630201710163D90C00001B1B1B1B1A01C3E1";
		
		SMLMeterData data=SMLDecoder.decode(Hex.decodeHex(payload), false);
		
		System.err.println(data);
		
		assertThat(data).isNotNull();
		
		assertThat(data.getMeterId()).isEqualTo("1DZG0042082910");
		
		assertThat(data.getReadings())
			.isNotNull()
			.extracting(Object::toString)
			.containsExactlyInAnyOrder(
					 "1-0:1.8.0*255 / energyImportTotal = 5430157.7 WATT_HOUR",
					 "1-0:2.8.0*255 / energyExportTotal = 26244572.6 WATT_HOUR",
					 "1-0:16.7.0*255 / powerTotal = -299.12 WATT"					
				);
	}
	
	@Test
	public void testDZG_DVS_7420_2V_G2_mtr0() throws Exception {
		// DZG_DVS-7420.2V.G2_mtr0.hex
		
		String payload="1B1B1B1B0101010176057123AF01620062007263010176010102310B0A01445A4700039E2054726201648FCCB4620263379A0076057223AF01620062007263070177010B0A01445A4700039E2054070100620AFFFF726201648FCCB47577070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20540177070100010800FF641C01047262016200621E52FF645CB0670177070100020800FF017262016200621E52FF64C149960177070100100700FF017262016200621B52FE53545F0101016308DD0076057323AF016200620072630201710163E04800001B1B1B1B1A0119671B1B1B1B0101010176057423AF01620062007263010176010102310B0A01445A4700039E2054726201648FCCB5620263EA830076057523AF";
		
		SMLMeterData data=SMLDecoder.decode(Hex.decodeHex(payload), false);
		
		System.err.println(data);
		
		assertThat(data).isNotNull();
		
		assertThat(data.getMeterId()).isEqualTo("1DZG0060694612");
		
		assertThat(data.getReadings())
			.isNotNull()
			.extracting(Object::toString)
			.containsExactlyInAnyOrder(
					 "1-0:1.8.0*255 / energyImportTotal = 607447.1 WATT_HOUR",
					 "1-0:2.8.0*255 / energyExportTotal = 1266728.6 WATT_HOUR",
					 "1-0:16.7.0*255 / powerTotal = 215.99 WATT"					
				);
	}
	
	@Test
	public void testDZG_DVS_7420_2V_G2_mtr1() throws Exception {
		// DZG_DVS-7420.2V.G2_mtr1.hex
		
		String payload="1B1B1B1B010101017605D225AF01620062007263010176010102310B0A01445A4700039E2055726201648FCD5C6202630172007605D325AF01620062007263070177010B0A01445A4700039E2055070100620AFFFF726201648FCD5C7777070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20550177070100010800FF641C00047262016200621E52FF65016723B90177070100010801FF017262016200621E52FF6405E4340177070100010802FF017262016200621E52FF6501613F850177070100020800FF017262016200621E52FF62000177070100100700FF017262016200621B52FE53026E01010163BA5B007605D425AF016200620072630201710163E806000000001B1B1B1B1A0311641B1B1B1B010101017605D525AF01620062007263010176010102310B0A01445A4700039E2055726201648FCD5D6202637317007605D625AF01620062007263070177010B0A01445A4700039E2055070100620AFFFF726201648FCD5D7777070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20550177070100010800FF641C00047262016200621E52FF65016723B90177070100010801FF017262016200621E52FF6405E4340177070100010802FF017262016200621E52FF6501613F850177070100020800FF017262016200621E52FF62000177070100100700FF017262016200621B52FE530254010101635543007605D725AF016200620072630201710163D685000000001B1B1B1B1A0358AF1B1B1B1B010101017605D825AF01620062007263010176010102310B0A01445A4700039E2055726201648FCD5E620263BB41007605D925AF01620062007263070177010B0A01445A4700039E2055070100620AFFFF726201648FCD5E7777070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20550177070100010800FF641C00047262016200621E52FF65016723B90177070100010801FF017262016200621E52FF6405E4340177070100010802FF017262016200621E52FF6501613F850177070100020800FF017262016200621E52FF62000177070100100700FF017262016200621B52FE53026D010101630067007605DA25AF016200620072630201710163E6E7000000001B1B1B1B1A0314151B1B1B1B010101017605DB25AF01620062007263010176010102310B0A01445A4700039E2055726201648FCD5F62026397DD007605DC25AF01620062007263070177010B0A01445A4700039E2055070100620AFFFF726201648FCD5F7777070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20550177070100010800FF641C00047262016200621E52FF65016723B90177070100010801FF017262016200621E52FF6405E4340177070100010802FF017262016200621E52FF6501613F850177070100020800FF017262016200621E52FF62000177070100100700FF017262016200621B52FE53024301010163A2CE007605DD25AF0162006200726302017101636197000000001B1B1B1B1A035AC11B1B1B1B010101017605DE25AF01620062007263010176010102310B0A01445A4700039E2055726201648FCD60620263FF52007605DF25AF01620062007263070177010B0A01445A4700039E205507010062";
		
		SMLMeterData data=SMLDecoder.decode(Hex.decodeHex(payload), false);
		
		System.err.println(data);
		
		assertThat(data).isNotNull();
		
		assertThat(data.getMeterId()).isEqualTo("1DZG0060694613");
		
		assertThat(data.getReadings())
			.isNotNull()
			.extracting(Object::toString)
			.containsExactlyInAnyOrder(
					 "1-0:1.8.0*255 / energyImportTotal = 2353656.9 WATT_HOUR",
					 "1-0:1.8.1*255 / energyImportTariff1 = 38610.0 WATT_HOUR",
					 "1-0:1.8.2*255 / energyImportTariff2 = 2315046.9 WATT_HOUR",
					 "1-0:2.8.0*255 / energyExportTotal = 0.0 WATT_HOUR",
					 "1-0:16.7.0*255 / powerTotal = 6.22 WATT"
				);
	}

	@Test
	public void testDZG_DVS_7420_2V_G2_mtr2() throws Exception {
		// DZG_DVS-7420.2V.G2_mtr2.hex
		
		String payload="1B1B1B1B010101017605CA24AF01620062007263010176010102310B0A01445A4700039E2053726201648FCC6F6202630B44007605CB24AF01620062007263070177010B0A01445A4700039E2053070100620AFFFF726201648FCC6F7577070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20530177070100010800FF641C00047262016200621E52FF640200E80177070100020800FF017262016200621E52FF64E4D65D0177070100100700FF017262016200621B52FE5302A501010163720B007605CC24AF016200620072630201710163F13A00001B1B1B1B1A01AAE41B1B1B1B010101017605CD24AF01620062007263010176010102310B0A01445A4700039E2053726201648FCC70620263F7B4007605CE24AF01620062007263070177010B0A01445A4700039E2053070100620AFFFF726201648FCC707577070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20530177070100010800FF641C00047262016200621E52FF640200E80177070100020800FF017262016200621E52FF64E4D65D0177070100100700FF017262016200621B52FE5302900101016330C3007605CF24AF016200620072630201710163CFB900001B1B1B1B1A013DD31B1B1B1B010101017605D024AF01620062007263010176010102310B0A01445A4700039E2053726201648FCC71620263CCAA007605D124AF01620062007263070177010B0A01445A4700039E2053070100620AFFFF726201648FCC717577070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20530177070100010800FF641C00047262016200621E52FF640200E80177070100020800FF017262016200621E52FF64E4D65D0177070100100700FF017262016200621B52FE53029C01010163E184007605D224AF016200620072630201710163280D00001B1B1B1B1A01E334";
		
		SMLMeterData data=SMLDecoder.decode(Hex.decodeHex(payload), false);
		
		System.err.println(data);
		
		assertThat(data).isNotNull();
		
		assertThat(data.getMeterId()).isEqualTo("1DZG0060694611");
		
		assertThat(data.getReadings())
			.isNotNull()
			.extracting(Object::toString)
			.containsExactlyInAnyOrder(
					 "1-0:1.8.0*255 / energyImportTotal = 13130.4 WATT_HOUR",
					 "1-0:2.8.0*255 / energyExportTotal = 1499708.5 WATT_HOUR",
					 "1-0:16.7.0*255 / powerTotal = 6.77 WATT"
				);
	}

	@Test
	public void testDZG_DVS_7420_2V_G2_mtr2_neg() throws Exception {
		// DZG_DVS-7420.2V.G2_mtr2_neg.hex
		// Remarks: Generator, has 2-bytes negative value 16.7.0
		
		String payload="1B1B1B1B0101010176051338B301620062007263010176010102310B0A01445A4700039E2053726201649128386202632F2B0076051438B301620062007263070177010B0A01445A4700039E2053070100620AFFFF726201649128387577070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20530177070100010800FF641C69047262016200621E52FF640204E90177070100020800FF017262016200621E52FF64E4EE4D0177070100100700FF017262016200621B52FE53D6CA01010163A8900076051538B301620062007263020171016350C300001B1B1B1B1A010DE31B1B1B1B0101010176051638B301620062007263010176010102310B0A01445A4700039E205372620164912839620263F2320076051738B301620062007263070177010B0A01445A4700039E2053070100620AFFFF726201649128397577070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20530177070100010800FF641C69047262016200621E52FF640204E90177070100020800FF017262016200621E52FF64E4EE4E0177070100100700FF017262016200621B52FE53D64A010101636A9B0076051838B301620062007263020171016360A100001B1B1B1B1A0156B71B1B1B1B0101010176051938B301620062007263010176010102310B0A01445A4700039E20537262016491283A62026395180076051A38B301620062007263070177010B0A01445A4700039E2053070100620AFFFF7262016491283A7577070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20530177070100010800FF641C69047262016200621E52FF640204E90177070100020800FF017262016200621E52FF64E4EE4E0177070100100700FF017262016200621B52FE53D73A0101016371820076051B38B30162006200726302017101635E2200001B1B1B1B1A014BA01B1B1B1B0101010176051C38B301620062007263010176010102310B0A01445A4700039E20537262016491283B62026348010076051D38B301620062007263070177010B0A01445A4700039E2053070100620AFFFF7262016491283B7577070100603201010172620162006200520004445A470177070100600100FF017262016200620052000B0A01445A4700039E20530177070100010800FF641C69047262016200621E52FF640204E90177070100020800FF017262016200621E52FF64E4EE4E017707010010";
		
		SMLMeterData data=SMLDecoder.decode(Hex.decodeHex(payload), false);
		
		System.err.println(data);
		
		assertThat(data).isNotNull();
		
		assertThat(data.getMeterId()).isEqualTo("1DZG0060694611");
		
		assertThat(data.getReadings())
			.isNotNull()
			.extracting(Object::toString)
			.containsExactlyInAnyOrder(
					 "1-0:1.8.0*255 / energyImportTotal = 13232.9 WATT_HOUR",
					 "1-0:2.8.0*255 / energyExportTotal = 1500321.3 WATT_HOUR",
					 "1-0:16.7.0*255 / powerTotal = -105.50 WATT"
				);
	}

	@Test
	public void testDrNeuhaus_SMARTY_ix_130() throws Exception {
		// DrNeuhaus_SMARTY_ix-130.hex
		
		String payload="1B1B1B1B010101017605000004FE620062007263010176010105AA0100000B0901444E540100002030010163A802007605000004FF620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52A97777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D84501010163330A007605000005006200620072630201710163389800001B1B1B1B1A01C5741B1B1B1B01010101760500000501620062007263010176010105AB0100000B0901444E5401000020300101632D9F00760500000502620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52AB7777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D84501010163B6DE0076050000050362006200726302017101638B6600001B1B1B1B1A01DA891B1B1B1B01010101760500000504620062007263010176010105AC0100000B0901444E5401000020300101633F4C00760500000505620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52AC7777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D8450101016305380076050000050662006200726302017101634F6D00001B1B1B1B1A013DC41B1B1B1B01010101760500000507620062007263010176010105AD0100000B0901444E540100002030010163253D00760500000508620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52AD7777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D845010101631D15007605000005096200620072630201710163037100001B1B1B1B1A01F4941B1B1B1B0101010176050000050A620062007263010176010105AE0100000B0901444E54010000203001016382A10076050000050B620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52AF7777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D84501010163054D0076050000050C6200620072630201710163C77A00001B1B1B1B1A01C3171B1B1B1B0101010176050000050D620062007263010176010105AF0100000B0901444E54010000203001016354530076050000050E620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52B07777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D845010101638E320076050000050F6200620072630201710163748400001B1B1B1B1A01807F1B1B1B1B01010101760500000510620062007263010176010105B00100000B0901444E540100002030010163441800760500000511620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52B17777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D8450101016363890076050000051262006200726302017101635F4200001B1B1B1B1A01063F1B1B1B1B01010101760500000513620062007263010176010105B10100000B0901444E5401000020300101635E6900760500000514620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52B37777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D845010101638A3D007605000005156200620072630201710163B9E200001B1B1B1B1A0129BC1B1B1B1B01010101760500000516620062007263010176010105B20100000B0901444E54010000203001016370FA00760500000517620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52B47777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D84501010163676C007605000005186200620072630201710163D75500001B1B1B1B1A01E5CE1B1B1B1B01010101760500000519620062007263010176010105B30100000B0901444E5401000020300101632F070076050000051A620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52B57777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D845010101637F410076050000051B620062007263020171016364AB00001B1B1B1B1A017E821B1B1B1B0101010176050000051C620062007263010176010105B40100000B0901444E5401000020300101633DD40076050000051D620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52B77777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D8450101016339AE0076050000051E6200620072630201710163A0A000001B1B1B1B1A01FE291B1B1B1B0101010176050000051F620062007263010176010105B50100000B0901444E54010000203001016327A500760500000520620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52B87777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF59000000000000000001770701000F0700FF0101621B520065000000000177078181C78205FF010101018302FEA5D6BC658D734673F5790051D61C2EBD55344A6285686DE3B645EE0104D65F5ABBA6CB68F1BFCB7FCF94F99CD4D84501010163F593007605000005216200620072630201710163232F00001B1B1B1B1A0168041B1B1B1B01010101760500000522620062007263010176010105B60100000B0901444E540100002030010163B61800760500000523620062007263070177010B0901444E540100002030070100620AFFFF72620165715D52B97777078181C78203FF0101010104444E540177070100000009FF010101010B0901444E5401000020300177070100020800FF6401010001621E52FF59000000000000AAD20177070100020801FF0101621E52FF59000000000000AAD20177070100020802FF0101621E52FF590000000000000000017707";
		
		SMLMeterData data=SMLDecoder.decode(Hex.decodeHex(payload), false);
		
		System.err.println(data);
		
		assertThat(data).isNotNull();
		
		assertThat(data.getMeterId()).isEqualTo("1DNT0100008240");
		
		assertThat(data.getReadings())
			.isNotNull()
			.extracting(Object::toString)
			.containsExactlyInAnyOrder(
					 "1-0:2.8.0*255 / energyExportTotal = 4373.0 WATT_HOUR",
					 "1-0:2.8.1*255 / energyExportTariff1 = 4373.0 WATT_HOUR",
					 "1-0:2.8.2*255 / energyExportTariff2 = 0.0 WATT_HOUR",
					 "1-0:15.7.0*255 = 0 WATT"
				);
	}

	@Test
	@Ignore // workaround not yet in place
	public void testEMH_ED300L_consumption() throws Exception {
		// EMH-ED300L_consumption.hex
		
		
		String payload="1B01760004C96272017601000FED45480256450199071652EF00006301064D0171CD01010F767707818203010145487701000001010B45480256CD070008FF01011E0047F977010101011EFF0047F97707010201625256000077010F00016252000301078182FF01010230EFA3DC46052FB9CBA3959C5016B286B13C194298DBA0016322760016F20000630101F7001B1B01851B1B0101071652F46200630101071665ED45480256450144760004C96262726301064D0171CD01010F76770781820301044D0107000001010B45480256CD070008FF01011E560A200107000801011EFF0047FA7707010201625256000077010F0001625200AB7781C7050183E85118880B0527CB80B2FD7A1674D0DB57BE38429806010161000716F800006301017F001B1B01851B0101760004C96200630101071665ED064D0171CD0163EE071652FB000063770B4548025645016565A07781C70301014548770100000101064D0171CD770101006382621E0047FB77010101011EFF000A200107010201625256000077010F0001625200C67781C705010101018302E830EFA3DC46052FB9CBA3959C5016B286B13C194298060101D7000716FE000063010108001B1B01F81B1B0101071652006272017601000FEE4548025645012B760004CA62627263770B454802564501010F767707818203FF0101010104454D480177070100000009FF010101010B06454D4801027156CD070008FF01011E0047FC770101016252560A20010708FF011EFF000001070007FF011B52000301078182FF0183E85118880B052FB9CBA3959C501674D0DB57BE384298DBA0016301760016CA626272027163BF1B1B1AC61B0101071652066272017601000FEE454802564501A2760004CA6262726301064D0171CD016565A77781C703010145487701000001010B45480256CD070008FF01011E0047FD770101016252560A20010708FF015256000077010F000162527781C7050183E85118880B0527CB80B2FD7A1662001B1B014C1B1B01010716520C6272017601000FEE454802564501280716520D00006301064D56010F76770781820301454877010000010106480256CD070008FF01011E0047FE770101016252FF0047FE770708FF011EFF000077010F0001625200C87781C7050183E85118880B0527CB80B2FD7A16B286B13C19429806010181000716100000630101AF1B1B1A9F1B1B01010716521262720101071665EE454802564501D50704CA6262726301064D0171CD010F76770781820301044D010700000101064D0171CD070008FF01011E016252560A20010708FF011EFF0000070007FF011B5200BD7781C7050183E85118880B0527CB80B2FD7A16B286B13C194298060101F9000716160000630101D81B1B1AA41B1B0101760004CA6200630101071665EE064D0171CD01633C0716521900006301064802564501010F76770781820301044D010700000101064D0171CD070008FF01011E004700770101016252560A210107010201625256000001070007FF011B52000301078182FF0183E851A3DC460527CB80B2FD7A16B286B13C1942980601014D7600161C000002716350001B1B01EF1B0101760004CA62630101071665EE454802564501B50716521F00006301064D0171CD010F76770781820301044D010700000101064D0171CD070008FF01011E004701770101016252560A21010708FF011EFF000077010F0001625200797781C7050183E85118880B0527CB80B2FD7A16B286B13C194298A0016339760016220000630101421B1B1A861B0101760004CA6200630101071665EE4D0171564501C60004CA62627263770B45480256450181820301044D010700000101064D0171CD070008FF01011E004702770101016252560A21010708FF011EFF000077010F0001625200A77781C7FF0183E85118880B05B9CBA3959C5016B28657BE384298060101EF000716280000630101CA1B1B1A271B1B0101760004CA6272017601000FEE4548025645016C0716526262726301064D0171CD016565BE7781C70301044D010700000101064D0171CD450177070100010800FF63018201621E004703770101016252560A210107010201625256000001070007FF011B5200A87781C7050183E85118880B0527CB80B2FD7A1674D0DB57BE384298DBA00163A37600162E0000630101BD001B1B01271B1B01010716526272017601000FEE454802564501050716523100006301064D0171CD016565C27781C70301044D010700000101064D0171CD070008FF01011E004704770101016252560A210107010201625256000077010F0001625200B67781C705010101018302E83051EF18A388DC0B4605B9CBA3959C5016B286B13C194298060101A0000716CA626272027163701B1B1A1D1B1B0101071652366272017601000FEE4548025645018C760004CA6262726301064D0171CD016565C67781C70301044D010700000101064D0171CD070008FF01011E004705770101016252560A21010708FF011EFF000077010F0001625200E67781C7050183E85118880B0527CB80B2FD7A1674D0DB57BE384298DBA00163917600163A0000630101AD1B1B1A631B01010716523C6272017601000FEE45480256450106760004CA6262726301064D0171CD01010F76770781820301044D010700000101064D0171CD770101006382621E004706770101016252560A21770708FF011EFF000077010F0001625200C77781C7FF0183E85118880B0527CB80B2FD7A16B286B13C194298060101C3000716400000630101EF1B1B1A7E1B0101071652426272017601000FEE454802564501180716524300006301064D0171CD016565CD7781C70301044D0107000001010B45480256CD0701006382621E560A2101070008016252560A21010708FF011EFF000077010F0001625200C87781C7050183E85118880B052FCB80B2FD7A1674D0DB57BE384298060163AF760016460000630101981B1B1AE21B01017600046272017601000FEE4D0171CD0163F10716524900006301064D0171CD016565D07781C70301044D0107000001010B45480256CD070008FF01011E52FF56000A4721080177070100010801011EFF004701070201625256000077010F00016252000501078182FF01010230EFA3DC460527CB80B2FD7A16B2DB57BE384298060101FF000716CA626272027163101B1B1A6E1B0101760004CA6272017601000FEE454802564501780716524F00006301064D0171CD016565D17781C70301044D010700000101064D0171CD070008FF01011E00210107000801011EFF00470B770708FF011EFF000077010F000162520001078182FF0183E85118880B052FB9CBA3959C5016B286B13C19429806010121000716520000630101881B1B01F61B1B0101760004CA6272017601000FEE454802564501A50716525500006301064D0171CD016565D47781C70301044D01070000010B45480256CD070008FF01011E002101070008016252560A21010708FF011EFF000077010F000162520001078182FF01010230EFA3DC460527CB80B2FD7A16B286B13C19429806010166000716580000630101001B1B1A0C1B1B01760004CA62720101071665EE4548025645010F0004CA6262726301064D0171CD016565D777818203014548770100000101064D0171CD070008FF01011E00470E770101016252560A21010702016252560000000177010F07FF01520501078182FF0183E85118880B0527CB80B2FD7A16B286B13C1942980601014B0007165E0000630101771B1B1A211B1B0101071652606200630101000FEE4D0171CD0163770004CA6262726301064D0171CD016565D97781C70301044D01070000010B45480256CD070008FF01011E00470107000801625200470F770708FF011EFF000077010F00016252002A7781C7050183E85118880B05B9CBA3959C501674D0DB57BE38429806010128000716640000630101301B1B1A291B0101760004CA6272017601000FEE454802564501FE0716526700006301064D0171CD016565DC7781C703014548770100000101064D0171CD070008FF01011E004710770101016252560A21010708FF015256000077010F00016252006C7781C7050183E85118880B0527CB80B2FD7A16B286B13C194298060101A00007166A0000630101ED1B1B1AF81B0101760004CA62720101071665EE454802564501740004CA6262726301064D0171CD01650703014548770100000101064D0171CD070008FF01011E004711770101016252564711770708FF011EFF000077010F0001625200497781C7050183E85118880B0527CB80B2FD7A16B286B13C19429806010147000716700000630101201B1B1A2D1B0101071652726272017601000FEE454802564501890716527300006301064D0171CD016565E17781C70301044D01070000010B45480256CD070008FF01011E00471277010101FF0101621E52FF56000A4721120177070102016252560077010F00016252000501078182FF0183E85118880B0527CB80B2FD7A16B286B13C194298060101F400071676000063010157001B1B1A221B1B1B1B01010101760700160452CA7862006200726301017601010700160F65EE280B06454D4801027156CD4501016360F500760700160452CA79620062007263070177010B06454D4801027156CD4501726201650F6576E37777078181C78203FF0101010104454D480177070100000009FF010101010B06454D4801027156CD450177070100010800FF63018201621E52FF56000A4721130177070100010801FF0101621E52FF56000A4721130177070100010802FF0101621E52FF56000000000001770701000F0700FF0101621B52FF550000055B0177078181C78205FF010101018302E83051EF18A388DC0B4605DBFF2F27B9CBCB80A3B295FD9C7A5016D42774B2D086DBB1573CBE193842429840EDDB06A0010101634C0000760700160452CA7C6200620072630201710163DF8800001B1B1B1B1A01B01F1B1B1B1B01010101760700160452CA7E62006200726301017601010700160F65EE2A0B06454D4801027156CD45010163E93300760700160452CA7F620062007263070177010B06454D4801027156CD4501726201650F6576E67777078181C78203FF0101010104454D480177070100000009FF010101010B06454D4801027156CD450177070100010800FF63018201621E52FF56000A4721140177070100010801FF016252560A210107010201625256000001070007FF011B525500AB7781C70501010230EFA3DC46052FB9CBA3959C501674D0DB57BE38980601014C000716820000630101D31B1B1AC51B0101760004CA6272017601000FEE064D0171CD01634D0716528500006301064D0171CD016565E87781C70301014548770100000101064D0171CD070008FF01011E560A2101070008016252560A21010708FF62525600000077010007FF016252000501078182FF01010230EFA3DC46052FB9CBA3959C5016B286B13C194298060101A90007168800006301015B1A001B1B01731B1B0101760004CA6200630101071665EE064D0171CD0163E7000716528B000063770B4548025645016565EB7781C70301014548770100000101064D0171CD0700006382621E560A2101070008016252560A21010708FF011EFF000001070007FF011B52000501078182FF0183E85118880B052F";
		
		SMLMeterData data=SMLDecoder.decode(Hex.decodeHex(payload), false);
		
		System.err.println(data);
		
		assertThat(data).isNotNull();
		
		assertThat(data.getMeterId()).isEqualTo("1DNT0100008240");
		
		assertThat(data.getReadings())
			.isNotNull()
			.extracting(Object::toString)
			.containsExactlyInAnyOrder(
					 "1-0:2.8.0*255 / energyExportTotal = 4373.0 WATT_HOUR",
					 "1-0:2.8.1*255 / energyExportTariff1 = 4373.0 WATT_HOUR",
					 "1-0:2.8.2*255 / energyExportTariff2 = 0.0 WATT_HOUR",
					 "1-0:15.7.0*255 = 0 WATT"
				);
	}
	
	
}
